# cloudraft-task

This is a Java-based web application that provides a simple key-value store API. It allows users to store and retrieve key-value pairs and search for keys based on prefixes and suffixes.

# Prerequisites

Make sure you have the following prerequisites installed on your system:

Java (version 17.0.7).
Maven (version 3.8.6).
Docker (version 24.0.2).
Kubernetes (version 1.25.9).
Terraform (version 1.5.1).

You can install these dependencies by running the following commands ":
```
sudo apt install update
```
```
sudo apt install upgrade -y
```
```
sudo apt install openjdk-17-jdk -y
```
```
sudo apt install maven -y
```
```
sudo apt install docker.io -y
```
```
sudo apt install kubernetes
```
```
sudo snap install terraform --classic
```
# Installation and Usage

1. Clone the repository
   ```
   git clone "https://github.com/Akshit-code/cloudraft-task.git"
   ```
   ```
   cd cloudraft-task/
   ```
2. Build the application using maven
   ```
   mvn clean install
   ```
3. Run the application locally
   ```
   java -jar target/cloudcraft-app-1.0-SNAPSHOT.jar
   ```
4. Access the API endpoints using your preferred HTTP client or web browser
   Http:
   
   Retrieve a value by key: GET http://localhost:8080/get/{key}
   
   Set a key-value pair: POST http://localhost:8080/set
   
   Search for keys by prefix and/or suffix: GET http://localhost:8080/search?prefix={prefix}&suffix={suffix}

   Web Browser :
   
   - just type "http://localhost:8080"
     
    (Note while using VM you will need to replace localhost with public ipv4 address of VM and while using kubernetes it will get replace with service address)

6. Docker Deployment
   To containerize the application using Docker, follow these steps:
   ```
   docker build -t cloudraft_task_image .
   ```
   Please feel free to replace "cloudraft_task_image" with a desired name. However, kindly make a note of the chosen name, as it will be necessary to replace the image name in the Kubernetes files for successful deployment.
   ```
   docker run -p 8080:8080 cloudraft_task_image
   ```

   Docker images can be stored in repositories like Docker Hub. Configure your command line with the credentials, then use docker push to store the image in the remote repository. Obtain the public URL for further use
   
7. Kubernetes Deployment
8. 
   Please replace the placeholder with the name of the Docker image used in the previous docker build command or paste the Docker image URL in the designated section of the Kubernetes deployment files. The current placeholder represents a public image URL of our web application generated by our team.
   ```
   kubectl apply -f deployment.yaml
   ```
   ```
   kubectl apply -f service.yaml
   ```
   ```
   kubectl get services
   ```
   Note down the IP address of above command output and replace it with "localhost" as shown in step 4 to interact with the web application.
   
9. Terraform Deployment on AWS using EKS
    
    First, install the AWS Command Line Interface (CLI) or SDK on your device and configure it with your AWS account:
   ```
   apt install awscli
   ```
   Optionally, you can also use pip to install the AWS CLI: pip install aws.
   
   Configure the AWS CLI:
   ```
   aws configure
   ```
   You will be prompted to enter the following information:

   AWS Access Key ID: Enter your AWS access key ID (provided by AWS).
   
   AWS Secret Access Key: Enter your AWS secret access key (provided by AWS).
   
   Default region name: Enter the AWS region you want to use (e.g., us-west-2).
   
   Default output format: Enter the desired output format (e.g., json).

   Now, to deploy using Terraform, you will need an SSH key. Generate a private SSH key using the same AWS account and store it in the terraform directory. Make a note of the SSH key name, as it will need to be replaced in the main.tf file.
   ```
   cd terraform
   ```
   Edit terraform with your editor and replce below code with your config path and SSH key pair. Below ihere is given example
   ```
   provider "kubernetes" {
      config_path = "/home/akshit/.kube/config"
   }
   ```
   ```
   remote_access {
      ec2_ssh_key     = "cloudraft_task_keypair"  # Specify the name of your SSH key pair
      source_security_group_ids = [aws_security_group.task_eks_sg.id]
   }
   ```
   To provision the required infrastructure on AWS using Terraform, use the provided Terraform configuration files:
   ```
   terraform init
   ```
   ```
   terraform plan
   ```
   ```
   terraform apply
   ```
   Note: This step may take up to 30 minutes to complete the deployment.

   Once the deployment is done, you can interact with the application as described in step 4.

   Feel free to reach out if you have any questions or need further assistance!
